<nav class="chat-navbar" (clickOutside)="closeMenus()">
    <div class="navbar-container">
        <!-- Left Section: Logo & Menu Toggle -->
        <div class="navbar-left">
            <button class="menu-toggle-btn" (click)="onMenuToggle()" aria-label="Toggle Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>

            <a routerLink="/chat" class="navbar-brand">
                <span class="brand-icon">üòä</span>
                <span class="brand-text">Smile Chat</span>
            </a>
        </div>

        <!-- Center Section: Search (Optional) -->
        <div class="navbar-center">
            <div class="navbar-search">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" placeholder="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™..." class="search-input">
            </div>
        </div>

        <!-- Right Section: Actions & User -->
        <div class="navbar-right">
            <!-- Notifications -->
            <div class="navbar-item notifications-wrapper">
                <button class="icon-btn notifications-btn" (click)="toggleNotifications()"
                    [class.active]="showNotifications()" aria-label="Notifications">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    @if (notificationCount() > 0) {
                    <span class="notification-badge">{{ notificationCount() }}</span>
                    }
                </button>

                <!-- Notifications Dropdown -->
                @if (showNotifications()) {
                <div class="dropdown-menu notifications-dropdown">
                    <div class="dropdown-header">
                        <h3>ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</h3>
                        <button class="mark-read-btn" (click)="markAllAsRead()">ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ ŸÉŸÖŸÇÿ±Ÿàÿ°</button>
                    </div>

                    <div class="notifications-list">
                        @for (notification of notifications(); track notification.id) {
                        <div class="notification-item" [class.unread]="!notification.read">
                            <div class="notification-icon" [class]="notification.type">
                                @if (notification.type === 'message') {
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                } @else if (notification.type === 'mention') {
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <line x1="19" y1="8" x2="19" y2="14"></line>
                                    <line x1="22" y1="11" x2="16" y2="11"></line>
                                </svg>
                                } @else {
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="16" x2="12" y2="12"></line>
                                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                </svg>
                                }
                            </div>
                            <div class="notification-content">
                                <h4>{{ notification.title }}</h4>
                                <p>{{ notification.message }}</p>
                                <span class="notification-time">{{ notification.time }}</span>
                            </div>
                        </div>
                        } @empty {
                        <div class="empty-notifications">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</p>
                        </div>
                        }
                    </div>
                </div>
                }
            </div>

            <!-- User Menu -->
            <div class="navbar-item user-menu-wrapper">
                <button class="user-menu-btn" (click)="toggleUserMenu()" [class.active]="showUserMenu()">
                    <div class="user-avatar">
                        <img [src]="authService.currentUser()?.avatar" alt="" srcset="">
                    </div>
                    <span class="user-name">{{ authService.currentUser()?.username }}</span>
                    <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>

                <!-- User Dropdown -->
                @if (showUserMenu()) {
                <div class="dropdown-menu user-dropdown">
                    <div class="user-info">
                        <div class="user-avatar-large">
                            <img [src]="authService.currentUser()?.avatar" alt="" srcset="">
                        </div>
                        <div class="user-details">
                            <h3>{{ authService.currentUser()?.username }}</h3>
                            <p>{{ authService.currentUser()?.email }}</p>
                        </div>
                    </div>

                    <div class="dropdown-divider"></div>

                    <a routerLink="/profile" class="dropdown-item" (click)="closeMenus()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span>ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</span>
                    </a>

                    <a routerLink="/settings" class="dropdown-item" (click)="closeMenus()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
                        </svg>
                        <span>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                    </a>

                    <a routerLink="/help" class="dropdown-item" (click)="closeMenus()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        <span>ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©</span>
                    </a>

                    <div class="dropdown-divider"></div>

                    <button class="dropdown-item logout" (click)="onLogout()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        <span>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</span>
                    </button>
                </div>
                }
            </div>
        </div>
    </div>
</nav>