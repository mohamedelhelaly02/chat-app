<section class="chat-users-page">
  <div class="chat-users-header">
    <h1>المحادثات</h1>
    <p>اختر مستخدمًا لبدء محادثة جديدة.</p>
  </div>

  @if (isLoading()) {
  <div class="chat-users-state loading">
    <div class="spinner"></div>
    <p>جاري تحميل المستخدمين...</p>
  </div>
  } @else if (errorMessage()) {
  <div class="chat-users-state error">
    <p>{{ errorMessage() }}</p>
    <button class="retry-btn" (click)="ngOnInit()">إعادة المحاولة</button>
  </div>
  } @else {
  <div class="chat-users-layout">
    @if (currentUser()) {
    <aside class="current-user-card">
      <h2>حسابك</h2>
      <div class="user-card">
        <div class="avatar">
          <img [src]="currentUser()?.avatar" alt="" srcset="">
        </div>
        <div class="info">
          <h3>{{ currentUser()?.username }}</h3>
          <p>{{ currentUser()?.email }}</p>
        </div>
      </div>
    </aside>
    }

    <main class="users-list-wrapper">
      <div class="users-list-header">
        <h2>المستخدمون المتاحون</h2>
        <span class="count-badge">{{ users().length }}</span>
      </div>

      @if (users().length === 0) {
      <div class="chat-users-state empty">
        <p>لا يوجد مستخدمون آخرون متاحون حاليًا.</p>
      </div>
      } @else {
      <div class="users-grid">
        @for (user of users(); track user._id) {
        <article class="user-card">
          <div class="avatar">
            <img [src]="user.avatar" [alt]="user.username" srcset="">
          </div>
          <div class="info">
            <h3>{{ user.username }}</h3>
            <p>{{ user.email }}</p>
          </div>
          <button class="start-chat-btn">
            بدء المحادثة
          </button>
        </article>
        }
      </div>
      }
    </main>
  </div>
  }
</section>